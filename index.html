<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Pagamentos - Clientes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tab-active { background: linear-gradient(135deg, #3b82f6, #6366f1); color: white; }
        .tab-inactive { background: #f3f4f6; color: #6b7280; }
        .file-drop-zone { border: 2px dashed #d1d5db; transition: all 0.3s ease; }
        .file-drop-zone:hover { border-color: #3b82f6; background-color: #eff6ff; }
        .file-drop-zone.dragover { border-color: #3b82f6; background-color: #dbeafe; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">üí∞ Controle de Pagamentos Maira</h1>
        </div>

        <!-- Navega√ß√£o por Abas -->
        <div class="bg-white rounded-2xl shadow-xl mb-8">
            <div class="flex border-b">
                <button id="tabClientes" class="flex-1 py-4 px-6 text-center font-semibold rounded-tl-2xl tab-active" onclick="trocarAba('clientes')">
                    üë• Clientes
                </button>
                <button id="tabTransacoes" class="flex-1 py-4 px-6 text-center font-semibold tab-inactive" onclick="trocarAba('transacoes')">
                    üí≥ Transa√ß√µes
                </button>

                <button id="tabRelatorios" class="flex-1 py-4 px-6 text-center font-semibold rounded-tr-2xl tab-inactive" onclick="trocarAba('relatorios')">
                    üìä Relat√≥rios
                </button>
            </div>
        </div>

        <!-- Aba Clientes -->
        <div id="abaClientes" class="aba-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Formul√°rio de Cadastro de Cliente -->
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                        <span class="mr-2">üë§</span> Cadastrar Novo Cliente
                    </h2>
                    
                    <form id="clienteForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">C√≥digo do Cliente</label>
                            <input type="text" id="codigoNovoCliente" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                   placeholder="Ex: CLI001, 12345">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                            <input type="text" id="nomeNovoCliente" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                   placeholder="Nome completo do cliente">
                        </div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email (Opcional)</label>
                            <input type="email" id="emailNovoCliente"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                   placeholder="email@exemplo.com">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Telefone (Opcional)</label>
                            <input type="tel" id="telefoneNovoCliente"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                   placeholder="(11) 99999-9999">
                        </div>

                
                     
                        <button type="submit" 
                                class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-green-700 hover:to-emerald-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                            ‚úÖ Cadastrar Cliente
                        </button>
                    </form>
                </div>

                <!-- Lista de Clientes Cadastrados -->
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                        <span class="mr-2">üìã</span> Clientes Cadastrados
                    </h2>
                    
                    <!-- Campo de Busca -->
                    <div class="mb-4">
                        <div class="relative">
                            <input type="text" id="buscaCliente" 
                                   class="w-full px-4 py-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                   placeholder="üîç Buscar por c√≥digo ou nome...">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-400">üîç</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="listaClientesCadastrados" class="space-y-3 max-h-96 overflow-y-auto">
                        <div class="text-center text-gray-500 py-8">
                            <span class="text-4xl mb-4 block">üë•</span>
                            <p>Nenhum cliente cadastrado</p>
                            <p class="text-sm">Cadastre o primeiro cliente</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Busca Avan√ßada de Cliente -->
            <div class="bg-white rounded-2xl shadow-xl p-6 mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <span class="mr-2">üîç</span> Busca Avan√ßada - Relat√≥rio Individual
                </h2>
                
                <!-- Seletor de Cliente -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Selecione o Cliente</label>
                    <select id="clienteBuscaSelect" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        <option value="">Escolha um cliente para ver o relat√≥rio completo</option>
                    </select>
                </div>
                
                <!-- Filtros de Data -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data Inicial</label>
                        <input type="date" id="dataInicial" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data Final</label>
                        <input type="date" id="dataFinal" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                    </div>
                </div>
                
                <button onclick="gerarRelatorioCliente()" 
                        class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-blue-700 hover:to-indigo-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                    üìä Gerar Relat√≥rio Individual
                </button>
            </div>
            
            <!-- Relat√≥rio do Cliente -->
            <div id="relatorioCliente" class="hidden">
                <!-- Cabe√ßalho do Relat√≥rio -->
                <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800" id="nomeClienteRelatorio"></h3>
                            <p class="text-gray-600" id="codigoClienteRelatorio"></p>
                            <p class="text-sm text-gray-500" id="periodoRelatorio"></p>
                        </div>
                        <button onclick="imprimirRelatorio()" 
                                class="bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-all">
                            üñ®Ô∏è Imprimir
                        </button>
                    </div>
                    
                    <!-- Resumo Financeiro do Cliente -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="bg-green-50 rounded-lg p-4 text-center">
                            <p class="text-green-600 text-sm font-medium">Total Entradas</p>
                            <p class="text-2xl font-bold text-green-700" id="totalEntradasCliente">R$ 0,00</p>
                        </div>
                        <div class="bg-red-50 rounded-lg p-4 text-center">
                            <p class="text-red-600 text-sm font-medium">Total Sa√≠das</p>
                            <p class="text-2xl font-bold text-red-700" id="totalSaidasCliente">R$ 0,00</p>
                        </div>
                        <div class="bg-blue-50 rounded-lg p-4 text-center">
                            <p class="text-blue-600 text-sm font-medium">Saldo Final</p>
                            <p class="text-2xl font-bold text-blue-700" id="saldoFinalCliente">R$ 0,00</p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <p class="text-gray-600 text-sm font-medium">Total Transa√ß√µes</p>
                            <p class="text-2xl font-bold text-gray-700" id="totalTransacoesCliente">0</p>
                        </div>
                    </div>
                </div>
                
                <!-- Hist√≥rico Detalhado -->
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                        <span class="mr-2">üìã</span> Hist√≥rico Detalhado
                    </h3>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="bg-gray-50 border-b">
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Data</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Tipo</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Descri√ß√£o</th>
                                    <th class="text-center py-3 px-4 font-semibold text-gray-700">Comprovante</th>
                                    <th class="text-right py-3 px-4 font-semibold text-gray-700">Valor</th>
                                    <th class="text-right py-3 px-4 font-semibold text-gray-700">Saldo Acumulado</th>
                                </tr>
                            </thead>
                            <tbody id="historicoDetalhadoCliente">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Aba Transa√ß√µes -->
        <div id="abaTransacoes" class="aba-content" style="display: none;">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Formul√°rio de Transa√ß√£o -->
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                        <span class="mr-2">‚ûï</span> Nova Transa√ß√£o
                    </h2>
                    
                    <form id="transacaoForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Data da Transa√ß√£o</label>
                            <input type="date" id="data" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cliente</label>
                            <select id="clienteSelect" required 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <option value="">Selecione um cliente</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Transa√ß√£o</label>
                            <select id="tipo" required 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <option value="">Selecione o tipo</option>
                                <option value="entrada">üí∞ Entrada (Recebimento)</option>
                                <option value="saida">üí∏ Sa√≠da (Pagamento)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Valor (R$)</label>
                            <input type="number" id="valor" required step="0.01" min="0"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                   placeholder="0,00">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
                            <input type="text" id="descricao" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                   placeholder="Descri√ß√£o da transa√ß√£o">
                        </div>
                        
                        <!-- Upload de Comprovante -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Comprovante (Opcional)</label>
                            <div id="dropZone" class="file-drop-zone rounded-lg p-6 text-center cursor-pointer">
                                <input type="file" id="comprovante" accept="image/*,.pdf" class="hidden">
                                <div id="dropText">
                                    <span class="text-4xl mb-2 block">üìé</span>
                                    <p class="text-gray-600">Clique ou arraste o comprovante aqui</p>
                                    <p class="text-sm text-gray-500">PNG, JPG ou PDF at√© 5MB</p>
                                </div>
                                <div id="filePreview" class="hidden">
                                    <span class="text-4xl mb-2 block">‚úÖ</span>
                                    <p class="text-green-600 font-medium" id="fileName"></p>
                                    <button type="button" onclick="removerArquivo()" class="text-red-500 text-sm mt-2">Remover arquivo</button>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" 
                                class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-blue-700 hover:to-indigo-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                            ‚úÖ Registrar Transa√ß√£o
                        </button>
                    </form>
                </div>

                <!-- Lista de Clientes -->
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                        <span class="mr-2">üë•</span> Saldo por Cliente
                    </h2>
                    
                    <!-- Campo de Busca -->
                    <div class="mb-4">
                        <div class="relative">
                            <input type="text" id="buscaClienteSaldo" 
                                   class="w-full px-4 py-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                   placeholder="üîç Buscar cliente...">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-400">üîç</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="listaClientes" class="space-y-3 max-h-96 overflow-y-auto">
                        <div class="text-center text-gray-500 py-8">
                            <span class="text-4xl mb-4 block">üìä</span>
                            <p>Nenhum cliente cadastrado ainda</p>
                            <p class="text-sm">Adicione uma transa√ß√£o para come√ßar</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <!-- Aba Relat√≥rios -->
        <div id="abaRelatorios" class="aba-content" style="display: none;">
            <!-- Resumo Financeiro -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-green-500 rounded-2xl p-6 text-white shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm font-medium">Total Entradas</p>
                            <p class="text-2xl font-bold" id="totalEntradas">R$ 0,00</p>
                        </div>
                        <div class="bg-green-400 p-3 rounded-full">
                            <span class="text-2xl">üìà</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-red-500 rounded-2xl p-6 text-white shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-100 text-sm font-medium">Total Sa√≠das</p>
                            <p class="text-2xl font-bold" id="totalSaidas">R$ 0,00</p>
                        </div>
                        <div class="bg-red-400 p-3 rounded-full">
                            <span class="text-2xl">üìâ</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-blue-600 rounded-2xl p-6 text-white shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm font-medium">Saldo Total</p>
                            <p class="text-2xl font-bold" id="saldoTotal">R$ 0,00</p>
                        </div>
                        <div class="bg-blue-500 p-3 rounded-full">
                            <span class="text-2xl">üíé</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hist√≥rico de Transa√ß√µes -->
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <span class="mr-2">üìã</span> Hist√≥rico de Transa√ß√µes
                </h2>
                
                <!-- Campo de Busca e Filtros -->
                <div class="mb-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="relative">
                        <input type="text" id="buscaHistorico" 
                               class="w-full px-4 py-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                               placeholder="üîç Buscar transa√ß√µes...">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-gray-400">üîç</span>
                        </div>
                    </div>
                    
                    <select id="filtroTipo" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        <option value="">Todos os tipos</option>
                        <option value="entrada">üí∞ Entradas</option>
                        <option value="saida">üí∏ Sa√≠das</option>
                    </select>
                    
                    <select id="filtroCliente" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        <option value="">Todos os clientes</option>
                    </select>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="bg-gray-50 border-b">
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Data</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">C√≥digo</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Cliente</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Tipo</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Descri√ß√£o</th>
                                <th class="text-center py-3 px-4 font-semibold text-gray-700">Comprovante</th>
                                <th class="text-right py-3 px-4 font-semibold text-gray-700">Valor</th>
                            </tr>
                        </thead>
                        <tbody id="historicoTransacoes">
                            <tr>
                                <td colspan="7" class="text-center py-8 text-gray-500">
                                    <span class="text-4xl mb-4 block">üìù</span>
                                    <p>Nenhuma transa√ß√£o registrada</p>
                                    <p class="text-sm">As transa√ß√µes aparecer√£o aqui automaticamente</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados armazenados localmente
        let transacoes = JSON.parse(localStorage.getItem('transacoes')) || [];
        let clientesCadastrados = JSON.parse(localStorage.getItem('clientesCadastrados')) || {};
        let clientes = JSON.parse(localStorage.getItem('clientes')) || {};

        // Fun√ß√£o para salvar dados
        function salvarDados() {
            localStorage.setItem('transacoes', JSON.stringify(transacoes));
            localStorage.setItem('clientesCadastrados', JSON.stringify(clientesCadastrados));
            localStorage.setItem('clientes', JSON.stringify(clientes));
        }

        // Fun√ß√£o para trocar abas
        function trocarAba(aba) {
            // Esconder todas as abas
            document.querySelectorAll('.aba-content').forEach(el => el.style.display = 'none');
            
            // Remover classe ativa de todos os bot√µes
            document.querySelectorAll('[id^="tab"]').forEach(el => {
                el.className = el.className.replace('tab-active', 'tab-inactive');
            });
            
            // Mostrar aba selecionada
            document.getElementById('aba' + aba.charAt(0).toUpperCase() + aba.slice(1)).style.display = 'block';
            
            // Ativar bot√£o da aba
            document.getElementById('tab' + aba.charAt(0).toUpperCase() + aba.slice(1)).className = 
                document.getElementById('tab' + aba.charAt(0).toUpperCase() + aba.slice(1)).className.replace('tab-inactive', 'tab-active');
            
            // Atualizar dados se necess√°rio
            if (aba === 'transacoes') {
                atualizarSelectClientes();
            } else if (aba === 'clientes') {
                atualizarSelectClientesBusca();
            }
        }

        // Fun√ß√£o para formatar moeda
        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }

        // Fun√ß√£o para calcular totais
        function calcularTotais() {
            let totalEntradas = 0;
            let totalSaidas = 0;

            transacoes.forEach(transacao => {
                if (transacao.tipo === 'entrada') {
                    totalEntradas += transacao.valor;
                } else {
                    totalSaidas += transacao.valor;
                }
            });

            const saldoTotal = totalEntradas - totalSaidas;

            document.getElementById('totalEntradas').textContent = formatarMoeda(totalEntradas);
            document.getElementById('totalSaidas').textContent = formatarMoeda(totalSaidas);
            document.getElementById('saldoTotal').textContent = formatarMoeda(saldoTotal);

            // Mudar cor do saldo baseado no valor
            const saldoElement = document.getElementById('saldoTotal').parentElement.parentElement.parentElement;
            if (saldoTotal >= 0) {
                saldoElement.className = saldoElement.className.replace('bg-red-600', 'bg-blue-600');
            } else {
                saldoElement.className = saldoElement.className.replace('bg-blue-600', 'bg-red-600');
            }
        }

        // Fun√ß√£o para cadastrar cliente
        function cadastrarCliente(codigo, nome, email, telefone) {
            if (clientesCadastrados[codigo]) {
                alert('Cliente com este c√≥digo j√° existe!');
                return false;
            }
            
            clientesCadastrados[codigo] = {
                nome,
                email: email || '',
                telefone: telefone || '',
                dataCadastro: new Date().toLocaleDateString('pt-BR')
            };
            
            salvarDados();
            renderizarClientesCadastrados();
            atualizarSelectClientes();
            return true;
        }

        // Fun√ß√£o para renderizar clientes cadastrados
        function renderizarClientesCadastrados(filtro = '') {
            const lista = document.getElementById('listaClientesCadastrados');
            
            if (Object.keys(clientesCadastrados).length === 0) {
                lista.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <span class="text-4xl mb-4 block">üë•</span>
                        <p>Nenhum cliente cadastrado</p>
                        <p class="text-sm">Cadastre o primeiro cliente</p>
                    </div>
                `;
                return;
            }

            // Filtrar clientes
            const clientesFiltrados = Object.entries(clientesCadastrados).filter(([codigo, dados]) => {
                if (!filtro) return true;
                const termoBusca = filtro.toLowerCase();
                return codigo.toLowerCase().includes(termoBusca) || 
                       dados.nome.toLowerCase().includes(termoBusca) ||
                       (dados.email && dados.email.toLowerCase().includes(termoBusca)) ||
                       (dados.telefone && dados.telefone.includes(termoBusca));
            });

            if (clientesFiltrados.length === 0) {
                lista.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <span class="text-4xl mb-4 block">üîç</span>
                        <p>Nenhum cliente encontrado</p>
                        <p class="text-sm">Tente outro termo de busca</p>
                    </div>
                `;
                return;
            }

            lista.innerHTML = clientesFiltrados.map(([codigo, dados]) => `
                <div class="bg-gray-50 rounded-lg p-4 fade-in">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="font-semibold text-gray-800">${dados.nome}</h3>
                            <p class="text-sm text-blue-600 font-medium">C√≥digo: ${codigo}</p>
                            ${dados.email ? `<p class="text-sm text-gray-600">üìß ${dados.email}</p>` : ''}
                            ${dados.telefone ? `<p class="text-sm text-gray-600">üì± ${dados.telefone}</p>` : ''}
                            <p class="text-xs text-gray-500 mt-1">Cadastrado em: ${dados.dataCadastro}</p>
                        </div>
                        <button onclick="removerCliente('${codigo}')" class="text-red-500 hover:text-red-700 text-sm">
                            üóëÔ∏è Remover
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Fun√ß√£o para atualizar select de clientes
        function atualizarSelectClientes() {
            const select = document.getElementById('clienteSelect');
            select.innerHTML = '<option value="">Selecione um cliente</option>';
            
            Object.entries(clientesCadastrados).forEach(([codigo, dados]) => {
                const option = document.createElement('option');
                option.value = codigo;
                option.textContent = `${codigo} - ${dados.nome}`;
                select.appendChild(option);
            });
        }

        // Fun√ß√£o para remover cliente
        function removerCliente(codigo) {
            if (confirm('Tem certeza que deseja remover este cliente? Todas as transa√ß√µes relacionadas ser√£o mantidas.')) {
                delete clientesCadastrados[codigo];
                salvarDados();
                renderizarClientesCadastrados();
                atualizarSelectClientes();
            }
        }

        // Fun√ß√£o para atualizar saldos dos clientes
        function atualizarSaldosClientes() {
            clientes = {};
            
            transacoes.forEach(transacao => {
                if (!clientes[transacao.codigoCliente]) {
                    const clienteInfo = clientesCadastrados[transacao.codigoCliente];
                    clientes[transacao.codigoCliente] = { 
                        nome: clienteInfo ? clienteInfo.nome : transacao.nomeCliente,
                        entradas: 0, 
                        saidas: 0, 
                        saldo: 0 
                    };
                }
                
                if (transacao.tipo === 'entrada') {
                    clientes[transacao.codigoCliente].entradas += transacao.valor;
                } else {
                    clientes[transacao.codigoCliente].saidas += transacao.valor;
                }
                
                clientes[transacao.codigoCliente].saldo = clientes[transacao.codigoCliente].entradas - clientes[transacao.codigoCliente].saidas;
            });

            renderizarListaClientes();
        }

        // Fun√ß√£o para renderizar lista de clientes
        function renderizarListaClientes(filtro = '') {
            const listaClientes = document.getElementById('listaClientes');
            
            if (Object.keys(clientes).length === 0) {
                listaClientes.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <span class="text-4xl mb-4 block">üìä</span>
                        <p>Nenhum cliente cadastrado ainda</p>
                        <p class="text-sm">Adicione uma transa√ß√£o para come√ßar</p>
                    </div>
                `;
                return;
            }

            // Filtrar clientes
            let clientesFiltrados = Object.entries(clientes);
            if (filtro) {
                const termoBusca = filtro.toLowerCase();
                clientesFiltrados = clientesFiltrados.filter(([codigo, dados]) => 
                    codigo.toLowerCase().includes(termoBusca) || 
                    dados.nome.toLowerCase().includes(termoBusca)
                );
            }

            if (clientesFiltrados.length === 0) {
                listaClientes.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <span class="text-4xl mb-4 block">üîç</span>
                        <p>Nenhum cliente encontrado</p>
                        <p class="text-sm">Tente outro termo de busca</p>
                    </div>
                `;
                return;
            }

            const clientesOrdenados = clientesFiltrados.sort((a, b) => b[1].saldo - a[1].saldo);
            
            listaClientes.innerHTML = clientesOrdenados.map(([codigo, dados]) => `
                <div class="bg-gray-50 rounded-lg p-4 fade-in">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="font-semibold text-gray-800">${dados.nome}</h3>
                            <p class="text-sm text-gray-600">
                                C√≥digo: ${codigo} | 
                                Entradas: ${formatarMoeda(dados.entradas)} | 
                                Sa√≠das: ${formatarMoeda(dados.saidas)}
                            </p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold ${dados.saldo >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${formatarMoeda(dados.saldo)}
                            </p>
                            <span class="text-xs px-2 py-1 rounded-full ${dados.saldo >= 0 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${dados.saldo >= 0 ? 'Positivo' : 'Negativo'}
                            </span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Fun√ß√µes para upload de arquivo
        let arquivoSelecionado = null;

        function configurarUpload() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('comprovante');

            // Click para selecionar arquivo
            dropZone.addEventListener('click', () => fileInput.click());

            // Drag and drop
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    processarArquivo(files[0]);
                }
            });

            // Sele√ß√£o de arquivo
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    processarArquivo(e.target.files[0]);
                }
            });
        }

        function processarArquivo(file) {
            // Validar tamanho (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('Arquivo muito grande! M√°ximo 5MB.');
                return;
            }

            // Validar tipo
            const tiposPermitidos = ['image/jpeg', 'image/png', 'image/gif', 'application/pdf'];
            if (!tiposPermitidos.includes(file.type)) {
                alert('Tipo de arquivo n√£o permitido! Use PNG, JPG ou PDF.');
                return;
            }

            arquivoSelecionado = file;
            mostrarPreview(file);
        }

        function mostrarPreview(file) {
            document.getElementById('dropText').classList.add('hidden');
            document.getElementById('filePreview').classList.remove('hidden');
            document.getElementById('fileName').textContent = file.name;
        }

        function removerArquivo() {
            arquivoSelecionado = null;
            document.getElementById('dropText').classList.remove('hidden');
            document.getElementById('filePreview').classList.add('hidden');
            document.getElementById('comprovante').value = '';
        }

        function salvarArquivo(file, transacaoId) {
            if (!file) return null;
            
            const reader = new FileReader();
            return new Promise((resolve) => {
                reader.onload = function(e) {
                    const arquivoData = {
                        nome: file.name,
                        tipo: file.type,
                        tamanho: file.size,
                        data: e.target.result
                    };
                    
                    // Salvar no localStorage (limitado, mas funcional para demo)
                    localStorage.setItem(`arquivo_${transacaoId}`, JSON.stringify(arquivoData));
                    resolve(`arquivo_${transacaoId}`);
                };
                reader.readAsDataURL(file);
            });
        }

        // Fun√ß√£o para renderizar hist√≥rico
        function renderizarHistorico(filtros = {}) {
            const historicoTransacoes = document.getElementById('historicoTransacoes');
            
            if (transacoes.length === 0) {
                historicoTransacoes.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-8 text-gray-500">
                            <span class="text-4xl mb-4 block">üìù</span>
                            <p>Nenhuma transa√ß√£o registrada</p>
                            <p class="text-sm">As transa√ß√µes aparecer√£o aqui automaticamente</p>
                        </td>
                    </tr>
                `;
                return;
            }

            // Aplicar filtros
            let transacoesFiltradas = [...transacoes];
            
            // Filtro por busca
            if (filtros.busca) {
                const termoBusca = filtros.busca.toLowerCase();
                transacoesFiltradas = transacoesFiltradas.filter(transacao => {
                    const clienteInfo = clientesCadastrados[transacao.codigoCliente];
                    const nomeCliente = clienteInfo ? clienteInfo.nome : transacao.nomeCliente || '';
                    
                    return transacao.codigoCliente.toLowerCase().includes(termoBusca) ||
                           nomeCliente.toLowerCase().includes(termoBusca) ||
                           transacao.descricao.toLowerCase().includes(termoBusca) ||
                           transacao.data.includes(termoBusca);
                });
            }
            
            // Filtro por tipo
            if (filtros.tipo) {
                transacoesFiltradas = transacoesFiltradas.filter(transacao => transacao.tipo === filtros.tipo);
            }
            
            // Filtro por cliente
            if (filtros.cliente) {
                transacoesFiltradas = transacoesFiltradas.filter(transacao => transacao.codigoCliente === filtros.cliente);
            }

            if (transacoesFiltradas.length === 0) {
                historicoTransacoes.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-8 text-gray-500">
                            <span class="text-4xl mb-4 block">üîç</span>
                            <p>Nenhuma transa√ß√£o encontrada</p>
                            <p class="text-sm">Tente ajustar os filtros de busca</p>
                        </td>
                    </tr>
                `;
                return;
            }

            const transacoesOrdenadas = transacoesFiltradas.reverse();
            
            historicoTransacoes.innerHTML = transacoesOrdenadas.map(transacao => {
                const clienteInfo = clientesCadastrados[transacao.codigoCliente];
                const nomeCliente = clienteInfo ? clienteInfo.nome : transacao.nomeCliente || 'Cliente n√£o encontrado';
                
                return `
                    <tr class="border-b hover:bg-gray-50 fade-in">
                        <td class="py-3 px-4 text-sm text-gray-600">${transacao.data}</td>
                        <td class="py-3 px-4 font-medium text-blue-600">${transacao.codigoCliente}</td>
                        <td class="py-3 px-4 font-medium">${nomeCliente}</td>
                        <td class="py-3 px-4">
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                transacao.tipo === 'entrada' 
                                    ? 'bg-green-100 text-green-800' 
                                    : 'bg-red-100 text-red-800'
                            }">
                                ${transacao.tipo === 'entrada' ? 'üí∞ Entrada' : 'üí∏ Sa√≠da'}
                            </span>
                        </td>
                        <td class="py-3 px-4 text-gray-700">${transacao.descricao}</td>
                        <td class="py-3 px-4 text-center">
                            ${transacao.comprovante ? 
                                `<button onclick="visualizarComprovante('${transacao.comprovante}')" class="text-blue-600 hover:text-blue-800">
                                    üìé Ver
                                </button>` : 
                                '<span class="text-gray-400">-</span>'
                            }
                        </td>
                        <td class="py-3 px-4 text-right font-semibold ${
                            transacao.tipo === 'entrada' ? 'text-green-600' : 'text-red-600'
                        }">
                            ${transacao.tipo === 'entrada' ? '+' : '-'} ${formatarMoeda(transacao.valor)}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Fun√ß√£o para atualizar filtro de clientes no hist√≥rico
        function atualizarFiltroClientes() {
            const filtroCliente = document.getElementById('filtroCliente');
            filtroCliente.innerHTML = '<option value="">Todos os clientes</option>';
            
            Object.entries(clientesCadastrados).forEach(([codigo, dados]) => {
                const option = document.createElement('option');
                option.value = codigo;
                option.textContent = `${codigo} - ${dados.nome}`;
                filtroCliente.appendChild(option);
            });
        }

        function visualizarComprovante(comprovanteId) {
            const arquivo = JSON.parse(localStorage.getItem(comprovanteId));
            if (arquivo) {
                const novaJanela = window.open('', '_blank');
                if (arquivo.tipo === 'application/pdf') {
                    novaJanela.document.write(`
                        <html>
                            <head><title>Comprovante - ${arquivo.nome}</title></head>
                            <body style="margin:0;">
                                <embed src="${arquivo.data}" width="100%" height="100%" type="application/pdf">
                            </body>
                        </html>
                    `);
                } else {
                    novaJanela.document.write(`
                        <html>
                            <head><title>Comprovante - ${arquivo.nome}</title></head>
                            <body style="margin:0; display:flex; justify-content:center; align-items:center; min-height:100vh; background:#f0f0f0;">
                                <img src="${arquivo.data}" style="max-width:100%; max-height:100%; object-fit:contain;">
                            </body>
                        </html>
                    `);
                }
            }
        }

        // Fun√ß√£o para adicionar transa√ß√£o
        async function adicionarTransacao(data, codigoCliente, tipo, valor, descricao) {
            const transacaoId = Date.now();
            let comprovanteId = null;
            
            // Salvar arquivo se existir
            if (arquivoSelecionado) {
                comprovanteId = await salvarArquivo(arquivoSelecionado, transacaoId);
            }
            
            const novaTransacao = {
                id: transacaoId,
                data,
                codigoCliente,
                tipo,
                valor: parseFloat(valor),
                descricao,
                comprovante: comprovanteId
            };

            transacoes.push(novaTransacao);
            salvarDados();
            
            calcularTotais();
            atualizarSaldosClientes();
            renderizarHistorico();
            
            // Limpar arquivo selecionado
            removerArquivo();
        }

        // Event listeners para busca
        document.getElementById('buscaCliente').addEventListener('input', function(e) {
            renderizarClientesCadastrados(e.target.value);
        });

        document.getElementById('buscaClienteSaldo').addEventListener('input', function(e) {
            renderizarListaClientes(e.target.value);
        });

        document.getElementById('buscaHistorico').addEventListener('input', function(e) {
            aplicarFiltrosHistorico();
        });

        document.getElementById('filtroTipo').addEventListener('change', function(e) {
            aplicarFiltrosHistorico();
        });

        document.getElementById('filtroCliente').addEventListener('change', function(e) {
            aplicarFiltrosHistorico();
        });

        function aplicarFiltrosHistorico() {
            const filtros = {
                busca: document.getElementById('buscaHistorico').value,
                tipo: document.getElementById('filtroTipo').value,
                cliente: document.getElementById('filtroCliente').value
            };
            renderizarHistorico(filtros);
        }

        // Event listeners
        document.getElementById('clienteForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const codigo = document.getElementById('codigoNovoCliente').value.trim();
            const nome = document.getElementById('nomeNovoCliente').value.trim();
            const email = document.getElementById('emailNovoCliente').value.trim();
            const telefone = document.getElementById('telefoneNovoCliente').value.trim();

            if (codigo && nome) {
                if (cadastrarCliente(codigo, nome, email, telefone)) {
                    // Limpar formul√°rio
                    this.reset();
                    
                    // Atualizar filtros
                    atualizarFiltroClientes();
                    
                    // Feedback visual
                    const button = this.querySelector('button');
                    const originalText = button.innerHTML;
                    button.innerHTML = '‚úÖ Cliente Cadastrado!';
                    button.classList.add('bg-green-600');
                    
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.classList.remove('bg-green-600');
                    }, 2000);
                }
            }
        });

        document.getElementById('transacaoForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const data = document.getElementById('data').value;
            const codigoCliente = document.getElementById('clienteSelect').value;
            const tipo = document.getElementById('tipo').value;
            const valor = document.getElementById('valor').value;
            const descricao = document.getElementById('descricao').value.trim();

            if (data && codigoCliente && tipo && valor && descricao) {
                await adicionarTransacao(data, codigoCliente, tipo, valor, descricao);
                
                // Limpar formul√°rio
                this.reset();
                
                // Definir data padr√£o novamente
                const hoje = new Date().toISOString().split('T')[0];
                document.getElementById('data').value = hoje;
                
                // Feedback visual
                const button = this.querySelector('button');
                const originalText = button.innerHTML;
                button.innerHTML = '‚úÖ Transa√ß√£o Registrada!';
                button.classList.add('bg-green-600');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-green-600');
                }, 2000);
            }
        });

        // Inicializar a aplica√ß√£o
        function inicializar() {
            // Definir data padr√£o como hoje
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('data').value = hoje;
            
            // Configurar upload
            configurarUpload();
            
            // Renderizar dados
            renderizarClientesCadastrados();
            atualizarSelectClientes();
            atualizarFiltroClientes();
            calcularTotais();
            atualizarSaldosClientes();
            renderizarHistorico();
        }

        // Fun√ß√£o para atualizar select de clientes na busca
        function atualizarSelectClientesBusca() {
            const select = document.getElementById('clienteBuscaSelect');
            select.innerHTML = '<option value="">Escolha um cliente para ver o relat√≥rio completo</option>';
            
            Object.entries(clientesCadastrados).forEach(([codigo, dados]) => {
                const option = document.createElement('option');
                option.value = codigo;
                option.textContent = `${codigo} - ${dados.nome}`;
                select.appendChild(option);
            });
        }

        // Fun√ß√£o para gerar relat√≥rio do cliente
        function gerarRelatorioCliente() {
            const codigoCliente = document.getElementById('clienteBuscaSelect').value;
            const dataInicial = document.getElementById('dataInicial').value;
            const dataFinal = document.getElementById('dataFinal').value;
            
            if (!codigoCliente) {
                alert('Por favor, selecione um cliente!');
                return;
            }
            
            const clienteInfo = clientesCadastrados[codigoCliente];
            if (!clienteInfo) {
                alert('Cliente n√£o encontrado!');
                return;
            }
            
            // Filtrar transa√ß√µes do cliente
            let transacoesCliente = transacoes.filter(t => t.codigoCliente === codigoCliente);
            
            // Aplicar filtro de data se especificado
            if (dataInicial) {
                transacoesCliente = transacoesCliente.filter(t => t.data >= dataInicial);
            }
            if (dataFinal) {
                transacoesCliente = transacoesCliente.filter(t => t.data <= dataFinal);
            }
            
            // Ordenar por data
            transacoesCliente.sort((a, b) => new Date(a.data) - new Date(b.data));
            
            // Calcular totais
            let totalEntradas = 0;
            let totalSaidas = 0;
            let saldoAcumulado = 0;
            
            transacoesCliente.forEach(transacao => {
                if (transacao.tipo === 'entrada') {
                    totalEntradas += transacao.valor;
                    saldoAcumulado += transacao.valor;
                } else {
                    totalSaidas += transacao.valor;
                    saldoAcumulado -= transacao.valor;
                }
            });
            
            // Atualizar cabe√ßalho do relat√≥rio
            document.getElementById('nomeClienteRelatorio').textContent = clienteInfo.nome;
            document.getElementById('codigoClienteRelatorio').textContent = `C√≥digo: ${codigoCliente}`;
            
            let periodoTexto = 'Per√≠odo: Todas as transa√ß√µes';
            if (dataInicial && dataFinal) {
                periodoTexto = `Per√≠odo: ${new Date(dataInicial).toLocaleDateString('pt-BR')} a ${new Date(dataFinal).toLocaleDateString('pt-BR')}`;
            } else if (dataInicial) {
                periodoTexto = `Per√≠odo: A partir de ${new Date(dataInicial).toLocaleDateString('pt-BR')}`;
            } else if (dataFinal) {
                periodoTexto = `Per√≠odo: At√© ${new Date(dataFinal).toLocaleDateString('pt-BR')}`;
            }
            document.getElementById('periodoRelatorio').textContent = periodoTexto;
            
            // Atualizar resumo financeiro
            document.getElementById('totalEntradasCliente').textContent = formatarMoeda(totalEntradas);
            document.getElementById('totalSaidasCliente').textContent = formatarMoeda(totalSaidas);
            document.getElementById('saldoFinalCliente').textContent = formatarMoeda(saldoAcumulado);
            document.getElementById('totalTransacoesCliente').textContent = transacoesCliente.length;
            
            // Atualizar cor do saldo
            const saldoElement = document.getElementById('saldoFinalCliente');
            if (saldoAcumulado >= 0) {
                saldoElement.className = 'text-2xl font-bold text-green-700';
            } else {
                saldoElement.className = 'text-2xl font-bold text-red-700';
            }
            
            // Gerar hist√≥rico detalhado
            const historicoDetalhado = document.getElementById('historicoDetalhadoCliente');
            
            if (transacoesCliente.length === 0) {
                historicoDetalhado.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-8 text-gray-500">
                            <span class="text-4xl mb-4 block">üìù</span>
                            <p>Nenhuma transa√ß√£o encontrada para este per√≠odo</p>
                        </td>
                    </tr>
                `;
            } else {
                let saldoCorrente = 0;
                historicoDetalhado.innerHTML = transacoesCliente.map(transacao => {
                    if (transacao.tipo === 'entrada') {
                        saldoCorrente += transacao.valor;
                    } else {
                        saldoCorrente -= transacao.valor;
                    }
                    
                    return `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="py-3 px-4 text-sm text-gray-600">${new Date(transacao.data).toLocaleDateString('pt-BR')}</td>
                            <td class="py-3 px-4">
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                    transacao.tipo === 'entrada' 
                                        ? 'bg-green-100 text-green-800' 
                                        : 'bg-red-100 text-red-800'
                                }">
                                    ${transacao.tipo === 'entrada' ? 'üí∞ Entrada' : 'üí∏ Sa√≠da'}
                                </span>
                            </td>
                            <td class="py-3 px-4 text-gray-700">${transacao.descricao}</td>
                            <td class="py-3 px-4 text-center">
                                ${transacao.comprovante ? 
                                    `<button onclick="visualizarComprovante('${transacao.comprovante}')" class="text-blue-600 hover:text-blue-800">
                                        üìé Ver
                                    </button>` : 
                                    '<span class="text-gray-400">-</span>'
                                }
                            </td>
                            <td class="py-3 px-4 text-right font-semibold ${
                                transacao.tipo === 'entrada' ? 'text-green-600' : 'text-red-600'
                            }">
                                ${transacao.tipo === 'entrada' ? '+' : '-'} ${formatarMoeda(transacao.valor)}
                            </td>
                            <td class="py-3 px-4 text-right font-bold ${
                                saldoCorrente >= 0 ? 'text-blue-600' : 'text-red-600'
                            }">
                                ${formatarMoeda(saldoCorrente)}
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            // Mostrar o relat√≥rio
            document.getElementById('relatorioCliente').classList.remove('hidden');
            
            // Scroll para o relat√≥rio
            document.getElementById('relatorioCliente').scrollIntoView({ behavior: 'smooth' });
        }

        // Fun√ß√£o para imprimir relat√≥rio
        function imprimirRelatorio() {
            const codigoCliente = document.getElementById('clienteBuscaSelect').value;
            const clienteInfo = clientesCadastrados[codigoCliente];
            
            if (!clienteInfo) {
                alert('Nenhum cliente selecionado para impress√£o!');
                return;
            }
            
            // Obter dados do relat√≥rio
            const nomeCliente = document.getElementById('nomeClienteRelatorio').textContent;
            const codigoClienteTexto = document.getElementById('codigoClienteRelatorio').textContent;
            const periodoTexto = document.getElementById('periodoRelatorio').textContent;
            const totalEntradas = document.getElementById('totalEntradasCliente').textContent;
            const totalSaidas = document.getElementById('totalSaidasCliente').textContent;
            const saldoFinal = document.getElementById('saldoFinalCliente').textContent;
            const totalTransacoes = document.getElementById('totalTransacoesCliente').textContent;
            
            // Obter hist√≥rico detalhado
            const historicoTabela = document.getElementById('historicoDetalhadoCliente');
            let historicoHTML = '';
            
            if (historicoTabela.children.length > 0) {
                Array.from(historicoTabela.children).forEach(row => {
                    if (row.children.length >= 6) {
                        const data = row.children[0].textContent;
                        const tipo = row.children[1].textContent.replace('üí∞', '').replace('üí∏', '').trim();
                        const descricao = row.children[2].textContent;
                        const comprovante = row.children[3].textContent.includes('Ver') ? 'Sim' : 'N√£o';
                        const valor = row.children[4].textContent;
                        const saldoAcumulado = row.children[5].textContent;
                        
                        historicoHTML += `
                            <tr>
                                <td>${data}</td>
                                <td>${tipo}</td>
                                <td>${descricao}</td>
                                <td style="text-align: center;">${comprovante}</td>
                                <td style="text-align: right;">${valor}</td>
                                <td style="text-align: right; font-weight: bold;">${saldoAcumulado}</td>
                            </tr>
                        `;
                    }
                });
            }
            
            if (!historicoHTML) {
                historicoHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px;">Nenhuma transa√ß√£o encontrada para este per√≠odo</td></tr>';
            }
            
            // Criar conte√∫do para impress√£o
            const conteudoImpressao = `
                <!DOCTYPE html>
                <html lang="pt-BR">
                <head>
                    <meta charset="UTF-8">
                    <title>Relat√≥rio Financeiro - ${nomeCliente}</title>
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { 
                            font-family: 'Arial', sans-serif; 
                            line-height: 1.4; 
                            color: #333; 
                            padding: 20px;
                            background: white;
                        }
                        .header { 
                            text-align: center; 
                            margin-bottom: 30px; 
                            border-bottom: 2px solid #333;
                            padding-bottom: 20px;
                        }
                        .header h1 { 
                            font-size: 24px; 
                            margin-bottom: 10px; 
                            color: #2563eb;
                        }
                        .header p { 
                            font-size: 14px; 
                            color: #666; 
                        }
                        .resumo { 
                            display: grid; 
                            grid-template-columns: repeat(4, 1fr); 
                            gap: 15px; 
                            margin-bottom: 30px; 
                        }
                        .resumo-item { 
                            border: 1px solid #ddd; 
                            padding: 15px; 
                            text-align: center; 
                            border-radius: 8px;
                            background: #f9f9f9;
                        }
                        .resumo-item h3 { 
                            font-size: 12px; 
                            color: #666; 
                            margin-bottom: 8px; 
                            text-transform: uppercase;
                        }
                        .resumo-item p { 
                            font-size: 18px; 
                            font-weight: bold; 
                        }
                        .entradas { color: #16a34a; }
                        .saidas { color: #dc2626; }
                        .saldo { color: #2563eb; }
                        .transacoes { color: #374151; }
                        .historico { margin-top: 30px; }
                        .historico h2 { 
                            font-size: 18px; 
                            margin-bottom: 15px; 
                            color: #333;
                            border-bottom: 1px solid #ddd;
                            padding-bottom: 10px;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            font-size: 12px;
                        }
                        th, td { 
                            border: 1px solid #ddd; 
                            padding: 8px; 
                            text-align: left; 
                        }
                        th { 
                            background-color: #f5f5f5; 
                            font-weight: bold; 
                            color: #333;
                        }
                        tr:nth-child(even) { 
                            background-color: #f9f9f9; 
                        }
                        .entrada-valor { color: #16a34a; font-weight: bold; }
                        .saida-valor { color: #dc2626; font-weight: bold; }
                        .saldo-positivo { color: #2563eb; font-weight: bold; }
                        .saldo-negativo { color: #dc2626; font-weight: bold; }
                        .footer { 
                            margin-top: 30px; 
                            text-align: center; 
                            font-size: 10px; 
                            color: #666;
                            border-top: 1px solid #ddd;
                            padding-top: 15px;
                        }
                        @media print {
                            body { padding: 10px; }
                            .resumo { grid-template-columns: repeat(2, 1fr); }
                            table { font-size: 10px; }
                            th, td { padding: 6px; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>üí∞ Relat√≥rio Financeiro Individual</h1>
                        <h2>${nomeCliente}</h2>
                        <p>${codigoClienteTexto}</p>
                        <p>${periodoTexto}</p>
                        <p>Gerado em: ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}</p>
                    </div>
                    
                    <div class="resumo">
                        <div class="resumo-item">
                            <h3>Total Entradas</h3>
                            <p class="entradas">${totalEntradas}</p>
                        </div>
                        <div class="resumo-item">
                            <h3>Total Sa√≠das</h3>
                            <p class="saidas">${totalSaidas}</p>
                        </div>
                        <div class="resumo-item">
                            <h3>Saldo Final</h3>
                            <p class="saldo">${saldoFinal}</p>
                        </div>
                        <div class="resumo-item">
                            <h3>Total Transa√ß√µes</h3>
                            <p class="transacoes">${totalTransacoes}</p>
                        </div>
                    </div>
                    
                    <div class="historico">
                        <h2>üìã Hist√≥rico Detalhado com Saldo Acumulado</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Tipo</th>
                                    <th>Descri√ß√£o</th>
                                    <th style="text-align: center;">Comprovante</th>
                                    <th style="text-align: right;">Valor</th>
                                    <th style="text-align: right;">Saldo Acumulado</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${historicoHTML}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="footer">
                        <p>Relat√≥rio gerado automaticamente pelo Sistema de Controle de Pagamentos</p>
                        <p>Este documento cont√©m informa√ß√µes confidenciais</p>
                    </div>
                </body>
                </html>
            `;
            
            // Abrir nova janela e imprimir
            const janelaImpressao = window.open('', '_blank', 'width=800,height=600');
            
            if (janelaImpressao) {
                janelaImpressao.document.write(conteudoImpressao);
                janelaImpressao.document.close();
                
                // Aguardar carregamento e imprimir
                janelaImpressao.onload = function() {
                    setTimeout(() => {
                        janelaImpressao.focus();
                        janelaImpressao.print();
                        
                        // Fechar janela ap√≥s impress√£o (opcional)
                        janelaImpressao.onafterprint = function() {
                            janelaImpressao.close();
                        };
                    }, 500);
                };
            } else {
                alert('N√£o foi poss√≠vel abrir a janela de impress√£o. Verifique se o bloqueador de pop-ups est√° desabilitado.');
            }
        }

        // Carregar dados ao iniciar
        inicializar();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9797080f02bcef81',t:'MTc1NjkyMTIxOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

